# QML Component Architecture

This document outlines the architectural principles for the QuickShell QML components in this project. The goal is to create a highly modular and maintainable UI by breaking features down into small, single-purpose components.

## Guiding Principles

1.  **Componentization**: Every distinct piece of the UI should be its own `.qml` file (e.g., a clock, a button, a list of items).
2.  **Assembly**: A parent component should be responsible for assembling smaller components into a functional unit (e.g., `Taskbar.qml` assembles widgets).
3.  **Data Flow**: Data should flow from parent components down to child components via properties.
4.  **Environmental Constraints**: The QuickShell environment in this setup has proven to have limitations regarding live data access from within a running QML process. Specifically:
    *   File I/O from QML (`FileSystemWatcher`, `Qt.readUrl`, `XMLHttpRequest`) is unreliable.
    *   The `QtDBus` QML module is not available in Qt6.

Due to these constraints, we use two distinct patterns for our components.

---

## Component Patterns

### 1. Standard Component

A standard component is a simple `.qml` file that is self-contained or receives data from its parent.

**Example**: `ClockWidget.qml`
- **Role**: Displays the current time.
- **Behavior**: Contains its own `Timer` to update itself. It is fully self-sufficient.
- **Usage**: Instantiated directly inside `Taskbar.qml`.

### 2. Externally Managed Component (EMC)

An EMC is used for any UI element that needs to display **live data** from an external source (like Hyprland events).

Because of the environmental constraints, the QML process cannot *pull* live data. Therefore, an external shell script must *push* the data by regenerating the component and restarting it.

**Example**: `WorkspaceIndicator.qml`
- **Role**: Displays the workspace indicators (circles).
- **Behavior**: This component is a standalone QML `Window`. It is completely "dumb" and only knows how to render the data that is injected into it at launch time.
- **Orchestration**: The `ws-listener.sh` script is the orchestrator for this component.
    1.  It listens for Hyprland workspace events (`socat`).
    2.  On an event, it fetches the latest workspace state from `hyprctl`.
    3.  It uses `awk` to inject the state as a JSON object into `WorkspaceIndicator.qml.template`.
    4.  It saves the result as the final `WorkspaceIndicator.qml`.
    5.  It kills any existing `WorkspaceIndicator` process.
    6.  It launches the new `WorkspaceIndicator.qml` as a background process.
- **Integration**: A `windowrulev2` in `hyprland.conf` pins the component's window to the correct screen location, making it appear to be part of the main taskbar.

This pattern, while more complex, is the only reliable method found for displaying live external data in this QML environment.

---

## Directory Structure (`Taskbar` Example)

The `modules/quickshell/taskbar/` directory is structured to reflect this modular approach.

```
modules/quickshell/taskbar/
├── Taskbar.qml               # Main assembler for the static parts of the bar
├── widgets/
│   └── ClockWidget.qml       # A standard, self-contained component
└── workspace/
    ├── WorkspaceIndicator.qml  # The final EMC file (generated by ws-listener)
    └── templates/
        └── WorkspaceIndicator.qml.template # Template used to generate the EMC
```
